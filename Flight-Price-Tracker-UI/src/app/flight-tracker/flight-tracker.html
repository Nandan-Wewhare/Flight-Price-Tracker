<div class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 py-10">
    <div class="max-w-3xl mx-auto p-8 bg-white rounded-2xl shadow-xl">
        <h1 class="text-3xl font-extrabold text-blue-700 mb-2">Flight Price Tracker</h1>
        <div class="text-gray-500 mb-6">Track flight prices and get notified when your target is met!</div>

        <form (ngSubmit)="addTracking()" class="flex flex-col gap-5 mb-8">
            <div>
                <input type="text" [(ngModel)]="newTracking.origin" name="origin" placeholder="Origin IATA Airport Code"
                    class="border-2 border-blue-100 rounded-lg px-4 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-300 transition" />
            </div>
            <div>
                <input type="text" [(ngModel)]="newTracking.destination" name="destination"
                    placeholder="Destination IATA Airport Code"
                    class="border-2 border-blue-100 rounded-lg px-4 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-300 transition" />
            </div>
            <div>
                <input type="number" [(ngModel)]="newTracking.targetPrice" name="targetPrice" placeholder="Target Price"
                    class="border-2 border-blue-100 rounded-lg px-4 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-300 transition" />
            </div>
            <div>
                <input type="date" [(ngModel)]="newTracking.departureDate" name="date"
                    class="border-2 border-blue-100 rounded-lg px-4 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-300 transition" />
            </div>
            <button type="submit"
                class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-2 rounded-lg font-semibold shadow hover:from-blue-600 hover:to-purple-600 transition"
                [disabled]="adding">
                Add Tracking
            </button>
            @if (adding) {
            <div class="flex items-center mt-2">
                <svg class="animate-spin h-6 w-6 text-blue-500 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                </svg>
                <span class="text-blue-600 font-medium">Adding...</span>
            </div>
            }
        </form>

        @if (error) {
        <div class="text-red-600 mb-4 font-semibold">{{ error }}</div>
        }

        <div class="overflow-x-auto rounded-lg shadow mt-6">
            <table class="w-full border-collapse">
                <thead>
                    <tr class="bg-blue-100">
                        <th class="py-3 px-3 text-left font-semibold text-blue-700">Origin</th>
                        <th class="py-3 px-3 text-left font-semibold text-blue-700">Destination</th>
                        <th class="py-3 px-3 text-left font-semibold text-blue-700">Departure Date</th>
                        <th class="py-3 px-3 text-left font-semibold text-blue-700">Price</th>
                        <th class="py-3 px-3 text-left font-semibold text-blue-700">Lowest Price Fetched</th>
                        <th class="py-3 px-3 text-left font-semibold text-blue-700">Target Met</th>
                        <th class="py-3 px-3"></th>
                    </tr>
                </thead>
                <tbody>
                    @if (loading) {
                    <tr>
                        <td colspan="7" class="py-6 text-center text-blue-400 font-medium">
                            <div class="flex flex-col items-center">
                                <svg class="animate-spin h-8 w-8 text-blue-500 mb-2" xmlns="http://www.w3.org/2000/svg"
                                    fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                        stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor"
                                        d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                                </svg>
                                Loading trackings...
                            </div>
                        </td>
                    </tr>
                    }
                    @else {
                    @for (t of trackings; track t.id) {
                    <tr class="border-b hover:bg-blue-50 transition">
                        <td class="py-3 px-3 font-medium text-gray-700">{{ t.origin }}</td>
                        <td class="py-3 px-3 font-medium text-gray-700">{{ t.destination }}</td>
                        <td class="py-3 px-3 text-gray-500">{{ t.departureDate | date }}</td>
                        <td class="py-3 px-3 text-purple-700 font-semibold">{{ t.targetPrice | currency: 'INR' }}</td>
                        @if (t.notificationSent) {
                        @if (t.actualPrice > 0) {
                        <td class="py-3 px-3 text-purple-700 font-semibold">{{ t.actualPrice | currency: 'INR' }}</td>
                        }
                        @else {
                        <td class="py-3 px-3 text-gray-400 italic">Flights not found for the given itinerary</td>
                        }
                        }
                        @else {
                        <td class="py-3 px-3 text-gray-400 italic">Not fetched yet</td>
                        }
                        <td class="py-3 px-3 text-center">
                            @if (t.actualPrice === 0 && t.notificationSent) {
                            <span class="inline-flex items-center text-gray-400 font-semibold">N/A</span>
                            }
                            @else if (t.targetPrice && t.notificationSent && t.actualPrice <= t.targetPrice) { <span
                                class="inline-flex items-center text-green-600 font-semibold">
                                <svg class="h-5 w-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M5 13l4 4L19 7" />
                                </svg>
                                Yes
                                </span>
                                }
                                @else {
                                <span class="inline-flex items-center text-red-500 font-semibold">
                                    <svg class="h-5 w-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                    No
                                </span>
                                }
                        </td>
                        <td class="py-3 px-3"></td>
                    </tr>
                    }
                    @if (trackings.length === 0) {
                    <tr>
                        <td colspan="7" class="py-6 text-center text-gray-400 font-medium">No trackings yet.</td>
                    </tr>
                    }
                    }
                </tbody>
            </table>
        </div>
        <br>
        <div class="text-xs text-gray-400 mb-1">
            Powered by Microsoft Azure:
            <a href="https://learn.microsoft.com/azure/app-service/" class="underline hover:text-blue-600"
                target="_blank" rel="noopener">App Service</a>,
            <a href="https://learn.microsoft.com/azure/azure-functions/" class="underline hover:text-blue-600"
                target="_blank" rel="noopener">Function</a>,
            <a href="https://learn.microsoft.com/azure/cosmos-db/" class="underline hover:text-blue-600" target="_blank"
                rel="noopener">Cosmos DB</a>,
            <a href="https://learn.microsoft.com/azure/key-vault/" class="underline hover:text-blue-600" target="_blank"
                rel="noopener">Key Vault</a>
        </div>
    </div>
</div>